{% extends 'careapp/base.html' %}
{% load static %}

{% block content %}
<div class="page-header">
    <h2 class="page-title"><i class="fas fa-th-large"></i> Dashboard</h2>
    <div class="header-actions">
        <button class="btn btn-primary" onclick="location.href='{% url 'activity_create' %}'">
            <i class="fas fa-plus"></i> New Activity
        </button>
    </div>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <i class="fas fa-users"></i>
        <h3>{{ active_service_users }}</h3>
        <p>Active Service Users</p>
    </div>
    <div class="stat-card">
        <i class="fas fa-user-tie"></i>
        <h3>{{ active_staff }}</h3>
        <p>Active Staff Members</p>
    </div>
    <div class="stat-card">
        <i class="fas fa-walking"></i>
        <h3>{{ today_activities }}</h3>
        <p>Today's Activities</p>
    </div>
    <div class="stat-card">
        <i class="fas fa-exclamation-circle"></i>
        <h3>{{ pending_incidents }}</h3>
        <p>Pending Incidents</p>
    </div>
</div>

<div class="dashboard-sections">
    <div class="dashboard-section">
        <h3><i class="fas fa-walking"></i> Recent Activities</h3>
        <div class="card">
            <div class="card-body">
                {% if recent_activities %}
                <div class="activity-list">
                    {% for activity in recent_activities %}
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-{% if activity.activity_type == 'meal' %}utensils{% elif activity.activity_type == 'medical' %}first-aid{% else %}walking{% endif %}"></i>
                        </div>
                        <div class="activity-details">
                            <h4>{{ activity.title }}</h4>
                            <p>{{ activity.service_user.first_name }} {{ activity.service_user.last_name }}</p>
                            <span class="activity-time">{{ activity.date }} | {{ activity.start_time }}</span>
                        </div>
                        <div class="activity-status">
                            <span class="badge {% if activity.is_completed %}badge-success{% else %}badge-warning{% endif %}">
                                {% if activity.is_completed %}Completed{% else %}Pending{% endif %}
                            </span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted">No recent activities found.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="dashboard-section">
        <h3><i class="fas fa-exclamation-circle"></i> Recent Incidents</h3>
        <div class="card">
            <div class="card-body">
                {% if recent_incidents %}
                <div class="incident-list">
                    {% for incident in recent_incidents %}
                    <div class="incident-item">
                        <div class="incident-header">
                            <h4>{{ incident.title }}</h4>
                            <span class="badge badge-{{ incident.severity }}">{{ incident.get_severity_display }}</span>
                        </div>
                        <p>{{ incident.service_user.first_name }} {{ incident.service_user.last_name }} | {{ incident.date }}</p>
                        <p class="incident-desc">{{ incident.description|truncatewords:20 }}</p>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted">No recent incidents found.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<style>
.dashboard-sections {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 30px;
}

.dashboard-section {
    background: white;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.dashboard-section h3 {
    margin-bottom: 15px;
    color: var(--secondary-color);
    display: flex;
    align-items: center;
    gap: 10px;
}

.activity-item, .incident-item {
    padding: 15px;
    border-bottom: 1px solid #eee;
    display: flex;
    align-items: center;
}

.activity-item:last-child, .incident-item:last-child {
    border-bottom: none;
}

.activity-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--primary-color);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    margin-right: 15px;
}

.activity-details {
    flex: 1;
}

.activity-status {
    margin-left: 15px;
}

.incident-header {
    display: flex;
    justify-content: between;
    align-items: center;
    margin-bottom: 5px;
}

.incident-header h4 {
    margin: 0;
    flex: 1;
}

.incident-desc {
    color: #666;
    font-size: 14px;
}

.badge {
    padding: 5px 10px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 500;
}

.badge-success { background: #28a745; color: white; }
.badge-warning { background: #ffc107; color: black; }
.badge-low { background: #28a745; color: white; }
.badge-medium { background: #ffc107; color: black; }
.badge-high { background: #fd7e14; color: white; }
.badge-critical { background: #dc3545; color: white; }

@media (max-width: 768px) {
    .dashboard-sections {
        grid-template-columns: 1fr;
    }
    
    .stats-grid {
        grid-template-columns: 1fr 1fr;
    }
}

@media (max-width: 480px) {
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .activity-item, .incident-item {
        flex-direction: column;
        text-align: center;
    }
    
    .activity-icon {
        margin-right: 0;
        margin-bottom: 10px;
    }
}
</style>
{% endblock %}